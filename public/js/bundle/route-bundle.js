!function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";n.d(e,"a",function(){return a});var a=function(){function t(){this.ZOOM_LEVEL_BASE=.000246153846,this.ZOOM_LEVEL_STEP=.4514682741,this.MAX_GROUP_LEVEL=4,this._svg=SVG("map"),this._svg.attr("version","1.1"),this._svg.attr("role","graphics-document document"),this._zoomlevel=3,this._container="#map svg ",this.guides_drawn=!1,this.marker_groups=Array.apply(null,Array(20)).map(function(t){return[]}),this.auto_marker_groups=Array.apply(null,Array(20)).map(function(t){return[]}),this.auto_grouped_buildings=[]}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svg",{get:function(){return this._svg},set:function(t){this._svg=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomlevel",{get:function(){return this._zoomlevel},set:function(t){this._zoomlevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t},enumerable:!0,configurable:!0}),t.prototype.fetchData=function(){var t=this;if(void 0===this._data){var e=Cookies.get("locationRadio")||100;return $.getJSON("/map/data/"+e,function(t){return t})}new Promise(function(e,n){e(t._data)})},Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guidesDrawn",{get:function(){return this.guides_drawn},set:function(t){this.guides_drawn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullw",{get:function(){return this.svg.viewbox().width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullh",{get:function(){return this.svg.viewbox().height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDrawn",{set:function(t){this.onmapdrawn=t},enumerable:!0,configurable:!0}),t.prototype.draw=function(){var t=this;this.fetchData().then(function(e){t.data=e,t.svg.attr("id","this.svg_MAIN"),t.svg.attr("preserveAspectRatio","xMidYMid slice"),t.svg.attr("class","map-dragable"),t.svg.attr("tabindex",0);for(var n=t.svg.group().attr("id","SVG_MAIN_CONTENT").front(),a=function(e){var a=n.group().link("#feature-"+e.properties.id.value).attr("class","non-link building-wrapper feature-object").attr("id","link-feature-"+e.properties.id.value);a.attr("data-building",e.properties.id.value),a.attr("role","graphics-symbol img"),a.attr("data-name",e.properties.name.value),a.attr("data-coords",e.centerx+":"+e.centery),a.attr("data-description",e.properties.description.value),a.attr("data-nearest",e.nearestnames.reduce(function(t,e){return t+","+e})),a.attr("data-nearest-radius",e.nearestnamesradius);var r=a.path().attr("d",e.path);r.attr("id","feature-shape-"+e.properties.id.value),r.attr("class","building");var i=a.group().attr("id","marker-"+e.properties.id.value).attr("class","map-marker"),o=i.image("/images/building_marker.svg",14,14);o.attr("class","marker"),o.attr("x",e.centerx-15),o.attr("y",e.centery-7);var s=i.text(function(t){for(var n=e.properties.name.value.split(" "),a=[n[0]],r=1;r<n.length;r++){var i=n[r];a[a.length-1].length+i.length<=10||null!=i.match(/^(,|.|;|:|")$/i)?a[a.length-1]+=" "+i:a.push(i)}for(r=0;r<a.length;r++)0==r?t.tspan(a[r]):t.tspan(a[r]).move(e.centerx,e.centery).dy(5*r)});s.attr("text-anchor","start"),s.attr("id","label-"+(e.properties.id?e.properties.id.value:"")),s.attr("x",e.centerx),s.attr("y",e.centery),s.font({weight:"bold"}),a.attr("aria-labelledby","label-"+e.properties.id.value);for(var c=0,l=e.groups;c<l.length;c++){var u=l[c];t.marker_groups[u].push(e.properties.id.value)}},r=0,i=t.data.buildings;r<i.length;r++){a(i[r])}t.onmapdrawn()})},t.prototype.drawLocation=function(t,e){console.log("Location update",t,e);var n=$(this.container+"#locationg");if(0==n.length){var a=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();a.attr("id","locationg");var r=a.circle().radius(10);r.cx(t).cy(e),r.fill("deeppink")}else n.find("circle").attr("cx",t),n.find("circle").attr("cy",e)},t.prototype.drawOrientation=function(e,n,a){var r=$(this.container+"#orientationg");if(0==r.length){var i=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();i.attr("id","orientationg");var o=i.image("/images/arrow.svg");o.move(e-8,n-24),o.attr("width",16),o.attr("height",16)}else r.find("image").attr("x",e-8),r.find("image").attr("y",n-24);var s=a<0?a+360:a;$(t.instance.container+"#orientationg image").css({"transform-origin":e+"px "+n+"px",transform:"rotateZ("+s+"deg)"}),r.attr("data-orientation",s),r.attr("data-x",e),r.attr("data-y",n)},t.prototype.drawGuides=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){$(this.container+".jails").remove();for(var t=this.svg.group().addClass("jails").back(),e=this.zoomlevel,n=100/e+"%",a=this.svg.viewbox(),r=a.x,i=a.y,o=this.fullw/e,s=this.fullh/e,c=0;c<e;c++)for(var l=0;l<e;l++)t.rect(n,n).move(r+c*o,i+l*s).fill("transparent").stroke({width:1})}},t.prototype.calculateAutoGroups=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){this.drawGuides();for(var t=Array.apply(null,Array(20)).map(function(t){return[]}),e=0,n=this.data.groups;e<n.length;e++)for(var a=n[e],r=0;r<a.length;r++){var i=a[r];console.log(i),i.auto&&t[a].push(r)}for(var o=0,s=t;o<s.length;o++)for(var c=0,l=a=s[o];c<l.length;c++){var u=l[c];this.data.groups.splice(u,1)}for(var d=0,p=this.svg.select(".jails rect").members;d<p.length;d++){var h=p[d],v=!1;for(r=0;r<this.data.groups[this.zoomlevel].length;r++){var f=this.data.groups[this.zoomlevel][r];if(h.inside(f.lat,f.long)){v=!0;break}}if(!v){var g=0,m=void 0;for(r=0;r<this.data.buildings.length;r++){var b=this.data.buildings[r],y=b.centerx,$=b.centery;h.inside(y,$)&&-1==b.groups.indexOf(this.zoomlevel)&&(g++,-1==this.marker_groups[this.zoomlevel].indexOf(parseInt(b.properties.id.value))&&this.marker_groups[this.zoomlevel].push(parseInt(b.properties.id.value)),(void 0==m||parseInt(b.properties.priority.value)<parseInt(m.properties.priority.value))&&(m=b))}0!=g&&this.data.groups[this.zoomlevel].push({id:parseInt(m.centerx).toString()+parseInt(m.centery).toString(),affects:g,lat:m.centerx,long:m.centery,name:"Marcadores cerca de "+m.properties.name.value,radius:h.width()/2,auto:!0})}}}},t.prototype.groupMarkers=function(t){var e=0;this.calculateAutoGroups();for(var n=[],a=0,r=this.marker_groups;a<r.length;a++){for(var i=0,o=r[a];i<o.length;i++){var s=o[i];e==t?n.push(s):($("#link-feature-"+s).removeAttr("tabindex"),$("#link-feature-"+s).removeClass("non-clickable"),this.svg.select("#marker-"+s).show())}for(var c=0,l=this.data.groups[e];c<l.length;c++){var u=l[c];if(e==t){var d=1==u.affects.toString().length?1:u.affects.toString().length/2,p=this.svg.select("#SVG_MAIN_CONTENT").members[0].link("#gmarker-"+u.id).attr("class","non-link gmarker").attr("id","gmarker-"+u.id);p.attr("data-name",u.name);var h=p.group(),v=h.circle().radius(10);v.cx(u.lat).cy(u.long);var f=h.plain(u.affects).attr("text-anchor","middle");f.font({size:16/d}),f.move(u.lat,u.long-8/d),p.title(u.name).attr("id","gmarker-"+u.id+"-title"),p.attr("aria-labelledby","gmarker-"+u.id+"-title"),p.attr("data-coords",v.cx()+":"+v.cy()),f.attr("aria-hidden","true"),f.attr("role","presentation")}else for(var g=0,m=this.svg.select("#gmarker-"+u.id).members;g<m.length;g++){m[g].remove()}}e++}for(var b=0,y=n;b<y.length;b++){s=y[b];this.svg.select("#marker-"+s).hide(),$("#link-feature-"+s).attr("tabindex","-1"),$("#link-feature-"+s).addClass("non-clickable")}var w=this;$(this.container+"a.gmarker").on("focus",function(){$(this).on("keyup",function(t){if(13==t.which){t.preventDefault(),w.zoomlevel+=2;var e=$(this).attr("data-coords").split(":"),n=e[0],a=e[1];w.zoomAndMove(n,a,w.zoomlevel)}})}),$(this.container+"a.gmarker").on("click",function(t){t.preventDefault(),w.zoomlevel+=2;var e=$(this).attr("data-coords").split(":"),n=e[0],a=e[1];w.zoomAndMove(n,a,w.zoomlevel)}),this.updateSidebar()},t.prototype.isInview=function(e){var n=t.instance.svg.viewbox().x,a=t.instance.svg.viewbox().y,r=n+t.instance.svg.viewbox().width,i=a+t.instance.svg.viewbox().height,o=$(e).attr("data-coords"),s=parseFloat(o.split(":")[0]),c=parseFloat(o.split(":")[1]);return s>=n&&s<=r&&(c>=a&&c<=i)},t.prototype.updateSidebar=function(){var t=this;$("#currentViewPanel ul").empty(),this.zoomlevel<this.MAX_GROUP_LEVEL?$(this.container+".gmarker").each(function(e,n){var a=t.isInview(n);if($(n).attr("data-inview",String(a)),a){var r=$(n).attr("data-name"),i=$(n).attr("data-coords").split(":")[0],o=$(n).attr("data-coords").split(":")[1],s=document.createElement("li"),c=document.createElement("a");$(c).html("Grupo: "+r),$(c).attr("href","#"),$(c).attr("data-type","group"),$(c).attr("data-listened",String(!1)),$(c).attr("data-x",i),$(c).attr("data-y",o),$(s).append(c),$("#currentViewPanel ul").append(s)}}):$(this.container+"a.feature-object").each(function(e,n){var a=t.isInview(n);if($(t).attr("data-inview",String(a)),a){var r=$(n).attr("data-coords"),i=parseFloat(r.split(":")[0]),o=parseFloat(r.split(":")[1]),s=document.createElement("li"),c=document.createElement("a");$(c).html("Edificio: "+$(n).attr("data-name")),$(c).attr("href","#"),$(c).attr("data-id",$(n).attr("data-id")),$(c).attr("data-x",i),$(c).attr("data-y",o),$(s).append(c),$("#currentViewPanel ul").append(s)}})},t.prototype.getZoomValues=function(t,e){var n=$("#map").width();return{vbx:n/=this.ZOOM_LEVEL_BASE+(t-1)*this.ZOOM_LEVEL_STEP,wdiff:e?(this.svg.viewbox().width-n)/2:0}},t.prototype.resizeToLevel=function(t,e){var n=this;if(void 0===e&&(e=!0),!(t<2||t>21)){$(this.container+".jails").remove(),this.zoomlevel=t;var a=this.getZoomValues(t,e),r=a.vbx,i=a.wdiff;(e?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+i,this.svg.viewbox().y+i,r,r),window.location.href="#zoom="+t,setTimeout(function(){n.groupMarkers(t),n.updateSidebar()},400)}},t.prototype.move=function(t,e,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+t,this.svg.viewbox().y+e,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},t.prototype.moveTo=function(t,e,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(t-this.fullw/2,e-this.fullh/2,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},t.prototype.zoomAndMove=function(t,e,n,a){var r=this;void 0===a&&(a=!0),$(this.container+".jails").remove(),this.zoomlevel=n;var i=this.getZoomValues(n,!0),o=i.vbx,s=i.wdiff;(a?this.svg.animate({duration:250}):this.svg).viewbox(t-this.fullw/2+s,e-this.fullh/2+s,o,o),window.location.href="#zoom="+n,setTimeout(function(){r.groupMarkers(n),r.updateSidebar()},400)},t}()},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var a=n(0),r=n(2),i=n(3),o=function(){function t(){this.voice=new r.a,proj4.defs("EPSG:25830","+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs")}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.pageLoad=function(){a.a.instance.onDrawn=function(){setTimeout(function(){a.a.instance.groupMarkers(a.a.instance.zoomlevel)},100);var t=null,e=new i.a;e.watch(function(e,n){var r=proj4("EPSG:4326","EPSG:25830",[n,e]),i=r[0],o=r[1];t={x:i,y:-o},a.a.instance.drawLocation(i,-o)}),e.watchOrientation(function(e,n,r){null!=t&&a.a.instance.drawOrientation(t.x,t.y,e)}),a.a.instance.updateSidebar()},a.a.instance.draw()},Object.defineProperty(t.prototype,"voiceControl",{get:function(){return this.voice},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSearchVoiceQuery",{get:function(){return this.searchResultCallback},set:function(t){this.searchResultCallback=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSearchResultSelected",{get:function(){return this.searchResultSelected},set:function(t){this.searchResultSelected=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRouteCommand",{get:function(){return this.routeCommand},set:function(t){this.routeCommand=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onUnknownVoiceCommand",{get:function(){return this.uvc},set:function(t){this.uvc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchResultsForVoiceSelection",{get:function(){return this.srfvs},set:function(t){this.srfvs=t},enumerable:!0,configurable:!0}),t.prototype.startVoice=function(){var t=this;r.a.compatible()&&(r.a.setOn(!0),this.voice.start(function(e){var n=e.confidence,a=e.transcript;console.log("Voice received:"),console.log(n,a);var r=t.voice.parseAction(a);if(r)switch(console.log("Parsed as",r),r.name){case"unknown":return void t.onUnknownVoiceCommand();case"search":return void t.onSearchVoiceQuery(r.query);case"select":return void t.onSearchResultSelected(t.toDigit(r.item));case"route":return void t.onRouteCommand({origin:r.origin,target:r.target});case"access-routes":return void t.onRouteCommand(null);case"zoom":return void t.navigationHandler("acercar"===r.direction?"zoom-in":"zoom-out");default:return void t.navigationHandler(r.direction)}}))},t.prototype.stopVoice=function(){r.a.compatible()&&void 0!==this.voice&&(r.a.setOn(!1),this.voice.stop())},t.prototype.navigationHandler=function(t){var e=20-a.a.instance.zoomlevel+15,n=0,r=0;switch(t){case"up":r=-e;break;case"down":r=e;break;case"left":n=-e;break;case"right":n=e;break;case"zoom-in":return a.a.instance.zoomlevel=20==a.a.instance.zoomlevel?a.a.instance.zoomlevel:a.a.instance.zoomlevel+1,void a.a.instance.resizeToLevel(a.a.instance.zoomlevel);case"zoom-out":return a.a.instance.zoomlevel=1==a.a.instance.zoomlevel?a.a.instance.zoomlevel:a.a.instance.zoomlevel-1,void a.a.instance.resizeToLevel(a.a.instance.zoomlevel)}a.a.instance.move(n,r)},t.prototype.toDigit=function(t){var e=["uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez"];console.log(e.length,t);for(var n=0;n<e.length;n++)if(e[n]==t)return n+1;return-1},t}()},function(t,e,n){"use strict";var a=[{name:"antiloop",pattern:/(No te he entendido)|(El mapa está ahora escuchando)/i,extract:[]},{name:"move",pattern:/(mover) (mapa |mapas |plano )?(a |hacia |para )?(la derecha|la izquierda|arriba|abajo)/i,extract:[{name:"direction",position:4}]},{name:"zoom",pattern:/(alejar|acercar)( mapa)?/i,extract:[{name:"direction",position:1}]},{name:"search",pattern:/(buscar) ([\w | \d]+)+/i,extract:[{name:"query",position:2}]},{name:"select",pattern:/(seleccionar |elegir |escoger |ver )(número |resultado )*(\w+)+/i,extract:[{name:"item",position:3}]},{name:"access-routes",pattern:/i((acceder a)|(acceso a)|(ir a)) (((cálculo de)|(calcular)|(calculo de))+ )*(ruta)/i,extract:[]},{name:"route",pattern:/((ir )|(calcular ruta ))*desde ((\w|\d| )+) hasta ((\w|\d| )+)/i,extract:[{name:"origin",position:4},{name:"target",position:6}]}];n.d(e,"a",function(){return r});var r=function(){function t(){this.time_per_word=500,t.compatible()&&(this.list=new webkitSpeechGrammarList,this.list.addFromString(""),this.voice=new webkitSpeechRecognition,this.voice.lang="es-ES",this.voice.interimResults=!1,this.voice.maxAlternatives=1,this.voice.grammars=this.list,this.voice.continuous=!0),this.container=document.getElementById("speech")}return t.compatible=function(){return"undefined"!=typeof SpeechRecognition||"undefined"!=typeof webkitSpeechRecognition},t.isOn=function(){return this.on},t.setOn=function(t){this.on=t},t.prototype.say=function(e){var n=this,a=t.isOn();t.setOn(!1),this.stop(),this.container.innerHTML="",this.container.innerHTML=e,setTimeout(function(){t.setOn(a),n.start(n.onTranscript)},this.time_per_word*e.split(" ").length)},t.prototype.start=function(e){var n=this;if(console.log(t.isOn()),t.isOn()){this.onTranscript=e,this.voice.onresult=function(t){n.voice.stop();var a=t.results.length-1,r=t.results[a][0].transcript,i=t.results[a][0].confidence;i>=.75?e({confidence:i,transcript:r}):(console.log("Ignoring because of low confidence:"),console.log("("+i+") "+r))},this.voice.onend=function(){var n=this;console.log("Voice end and on="+t.isOn()),t.isOn()&&setTimeout(function(){n.start(e)},1e3)};try{this.voice.start()}catch(t){}console.log("Voice started...")}},t.prototype.stop=function(){this.voice.stop()},t.prototype.parseAction=function(t){var e=function(t){for(var e=0,n=a;e<n.length;e++){var r=n[e],i=t.match(r.pattern);if(null!=i){for(var o={name:r.name},s=0,c=r.extract;s<c.length;s++){var l=c[s];o[l.name]=i[l.position]}return o}}return{name:"unknown"}}(t);if(console.log(e),"move"==e.name)switch(e.direction){case"la derecha":e.direction="right";break;case"la izquierda":e.direction="left";break;case"arriba":e.direction="up";break;case"abajo":e.direction="down";break;default:e.direction=null}else if("zoom"===e.action)switch(e.direction){case"alejar":e.direction="zoom-out";break;case"acercar":e.direction="zoom-in";break;default:e.direction=null}return e},t.on=!1,t}()},function(t,e,n){"use strict";n.d(e,"a",function(){return a});var a=function(){function t(){this.orientationAccum=0}return t.prototype.isGeolocationAvailable=function(){return"geolocation"in navigator},t.prototype.watch=function(t){this.isGeolocationAvailable()&&navigator.geolocation.watchPosition(function(e){t(e.coords.latitude,e.coords.longitude)},function(t){console.log("[LOCATION WATCH] error",t)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},t.prototype.getCurrentPosition=function(t){navigator.geolocation.getCurrentPosition(function(e){t(e.coords.latitude,e.coords.longitude)},function(t){console.log("[LOCATION GET] error",t)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},t.prototype.watchOrientation=function(t){var e=this;window.addEventListener("deviceorientation",function(n){50==e.orientationAccum?(e.orientationAccum=0,t(n.alpha,n.beta,n.gamma)):e.orientationAccum++})},t}()},function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(1);$(document).ready(function(){window.gsvg=a.a.instance.svg,r.a.instance.pageLoad(),a.a.instance.moveTo(717444.93870502,-4251399.25399798);var t=!1;$("body").not("input").not("textarea").keydown(function(e){if(t=t||18==e.which){var n="";switch(e.which){case 189:case 171:n="zoom-out";break;case 187:case 173:n="zoom-in";break;case 38:n="up";break;case 40:n="down";break;case 37:n="left";break;case 39:n="right"}r.a.instance.navigationHandler(n)}}),$("body").not("input").not("textarea").keyup(function(e){18==e.which&&(t=!1)});var e,n,i=!1,o=!1,s="ontouchstart"in window?"touchmove":"mousemove",c="ontouchstart"in window?"touchend":"mouseup",l="ontouchstart"in window?"touchstart":"mousedown",u=$(a.a.instance.container).get(0).getScreenCTM();console.log(u),$(a.a.instance.container).on(l,function(t){t.preventDefault(),i=!("ontouchstart"in window)||1==t.touches.length,e="ontouchstart"in window?t.targetTouches[0].pageX:t.pageX,n="ontouchstart"in window?t.targetTouches[0].pageY:t.pageY}),$(a.a.instance.container).on(c,function(t){o&&a.a.instance.groupMarkers(a.a.instance.zoomlevel),i=!1}),$(a.a.instance.container).on(s,function(t){if(i){var r="ontouchstart"in window?t.targetTouches[0].pageX:t.pageX,s="ontouchstart"in window?t.targetTouches[0].pageY:t.pageY,c=(r-e)/-35,l=(s-n)/-35;a.a.instance.move(c,l,!1),o=!0}});var d,p=!1;$(a.a.instance.container).on("mousewheel DOMMouseScroll",function(t){if(t.preventDefault(),!p){var e="number"==typeof t.originalEvent.detail&&0!==t.originalEvent.detail?t.originalEvent.detail:t.originalEvent.wheelDelta;console.log("wheel",e),e>0?a.a.instance.resizeToLevel(a.a.instance.zoomlevel+1,!0):a.a.instance.resizeToLevel(a.a.instance.zoomlevel-1,!0),p=!0,setTimeout(function(){return p=!1},400)}});var h=!1;$(a.a.instance.container).on("touchstart",function(t){2==t.touches.length&&(h=!0,d=Math.abs(t.touches[0].pageX-t.touches[1].pageX))}),$(a.a.instance.container).not("a").on("touchmove",function(t){(t.preventDefault(),h&&!p&&2==t.touches.length)&&(Math.abs(t.touches[0].pageX-t.touches[1].pageX)>d?(a.a.instance.resizeToLevel(a.a.instance.zoomlevel+1,!0),p=!0):(a.a.instance.resizeToLevel(a.a.instance.zoomlevel-1,!0),p=!0),setTimeout(function(){return p=!1},400))})})},,function(t,e,n){n(4),t.exports=n(7)},function(t,e,n){"use strict";function a(t,e){var n=t.x,a=e.y,r={x:n-t.x,y:a-t.y},i={x:n-e.x,y:a-e.y};e.x,t.x,e.y,t.y;return Math.atan2(o(i),o(r))}function r(t,e){var n=t.y-e.y,a=t.x-e.x;return console.log("perspectiva",a,n),Math.abs(n)>Math.abs(a)?n>0?180:0:a>0?270:90}function i(t){return 180*t/Math.PI}function o(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function s(t,e,n,a,r){var i=function(t){return t*Math.PI/180}(r);r=parseFloat(r);var o=Math.sin(i),s=Math.cos(i),c=t-n,l=e-a;return[c*s-l*o+n,c*o+l*s+a]}n.r(e);var c=n(0),l=[];var u=n(3),d="fas fa-times red";function p(t,e){t.find("button i").attr("class",e)}function h(t,e,n){for(var a=s(t,e-150,t,e,n),r=a[0],i=(a[1]-e)/(r-t),o=function(n){return i*n-i*t+e},l=t;l<=t+150;l++){for(var u=o(l),d=null,p=0,h=c.a.instance.svg.select(".feature-object").members;p<h.length;p++){var v=h[p];if(v.inside(l,u)){d=v;break}}if(null!=d)return d}return null}$(document).ready(function(){loadSettings();var t,e,n,s=[!1,!1];$("#routeSource, #routeTarget").on("keypress",function(t){"Tab"!=t.originalEvent.code&&($(this).parent().find("button").removeClass("btn-primary btn-success btn-danger"),p($(this).parent(),"fas fa-search"))}),$(".routeBtn").on("click",function(a){if(a.preventDefault(),n="#"+$(this).attr("data-search"),p($(n),"fas fa-spinner rotating-spinner"),$(n).find("button").removeClass("btn-primary btn-success btn-danger"),$(n).find("button").addClass("btn-primary"),""==$(n).find("input").val())return p($(n),d),$(n).find("button").removeClass("btn-primary btn-success btn-danger"),void $(n).find("button").addClass("btn-danger");$.getJSON("/map/data/s/name/"+$(n).find("input").val(),function(a){if(200==a.code){var r=a.results;if(0==r.length)$(n).find("button").removeClass("btn-primary btn-success btn-danger"),$(n).find("button").addClass("btn-danger"),p($(n),d);else if(1==r.length)$(n).find("input").val(r[0].name),p($(n),"fas fa-check green"),$(n).find("button").removeClass("btn-primary btn-success btn-danger"),$(n).find("button").addClass("btn-success"),"#sourceForm"==n?(s[0]=!0,t=r[0].id):(s[1]=!0,e=r[0].id);else{var i="#sourceForm"==n?"Punto de origen":"Punto de destino";$("#searchModal .modal-body").empty(),$("#modalTitle").html(i);for(var o=0,c=r;o<c.length;o++){var l=c[o];console.log(l);var u=document.createElement("div"),h=document.createElement("input");$(h).attr("type","radio"),$(h).attr("data-feature",l.name),$(h).attr("aria-label","Elegir "+l.name+" como "+i),$(h).attr("name","featureSelection"),$(h).attr("id","feature-"+l.id),$(h).attr("value",l.name),$(h).attr("tabindex",0);var v=document.createElement("label");$(v).attr("for","feature-"+l.id),$(v).html(l.name),$(u).attr("class","check-group"),$(u).append(h),$(u).append(v),console.log(u),$("#searchModal .modal-body").append(u)}$("#searchModal").modal("show")}}})}),$("#searchModal").on("shown.bs.modal",function(t){$('#searchModal input[name="featureSelection"]:first').trigger("focus")}),$("#searchModal").on("hide.bs.modal",function(a){var r=$('#searchModal input[name="featureSelection"]:checked').val();if(void 0===r)p($(n),d),$(n).find("button").removeClass("btn-primary btn-success btn-danger"),$(n).find("button").addClass("btn-danger");else{var i=$('#searchModal input[name="featureSelection"]:checked').attr("id").split("feature-")[1];$(n).find("input").val(r),p($(n),"fas fa-check green"),$(n).find("button").removeClass("btn-primary btn-success btn-danger"),$(n).find("button").addClass("btn-success"),"#sourceForm"==n?(s[0]=!0,t=i):(s[1]=!0,e=i)}}),$("#calculateBtn").on("click",function(n){n.preventDefault();for(var u=!0,d=0,p=s;d<p.length;d++){var h=p[d];u=u&&h}console.log(u,t,e),u&&$.getJSON("/map/data/pi/"+t+","+e+","+$("#impairmentSelect").val(),function(t){console.log("path",t),function(t){$("#SVG_MAIN_CONTENT #route").empty();var e={x:t[0].vcenterx,y:t[0].vcentery},n={x:t[1].vcenterx,y:t[1].vcentery},s=r(n,e),u=s,d=i(a(n,e));90==s&&(d=90-d),270==s&&(d=90-d),$("#map svg #SVG_MAIN_CONTENT").css({"transform-origin":e.x+"px "+e.y+"px",transform:"rotateX(-45deg) rotateZ("+(s+d)+"deg)"}),$("#map svg #SVG_MAIN_CONTENT .map-marker").each(function(t){$(this).css({"transform-origin":$(this).find("text").attr("x")+"px "+$(this).find("text").attr("y")+"px",transform:"rotateX(0deg) rotateZ(-"+(s+d)+"deg)"})});var p=-1;l=[];for(var h=0;h<t.length;h++){if(h+1==t.length){l.push(t[h]),l[l.length-1].direction=-1,l[l.length-1].distance=o({x:e.x-l[l.length-1].vcenterx,y:e.y-l[l.length-1].vcentery});break}e={x:t[h].vcenterx,y:t[h].vcentery},n={x:t[h+1].vcenterx,y:t[h+1].vcentery},s=r(n,e),d=i(a(n,e)),90==s&&(d=90-d),270==s&&(d=90-d);var v=s-p,f=0;0==v?f=0:90==v?f=1:-90==v&&(f=2);var g=0;if(null!=t[h].iid&&t[h].iid.length>0)for(var m=0;m<t[h].iid.length;m++){var b={x:t[h].icenterx[m],y:t[h].icentery[m]},y=r(b,e),w=y-p;if(d=i(a(b,e)),90==y&&(d=90-d),270==y&&(d=90-d),!(d>20)){if(90==w){l.push(t[h]),l[l.length-1].direction=f,l[l.length-1].distance=o({x:n.x-e.x,y:n.y-e.y}),l[l.length-1].poi=!0,l[l.length-1].poidirection=1,l[l.length-1].poiname=t[h].iname[m],g++;break}if(-90==w){l.push(t[h]),l[l.length-1].direction=f,l[l.length-1].distance=o({x:n.x-e.x,y:n.y-e.y}),l[l.length-1].poi=!0,l[l.length-1].poidirection=2,l[l.length-1].poiname=t[h].iname[m],g++;break}}}if(s==p){var x=l.length-1;l[x].distance=l[x].distance+o({x:n.x-e.x,y:n.y-e.y})}else 0==g&&(l.push(t[h]),l[l.length-1].direction=f,l[l.length-1].distance=o({x:n.x-e.x,y:n.y-e.y}),l[l.length-1].poi=!1);p=s}for(var k=c.a.instance.svg.select("#SVG_MAIN_CONTENT").members[0].group().attr("id","route"),_=[],O=1,S=0,z=l;S<z.length;S++){var M=(j=z[S]).vcenterx,E=j.vcentery,T=k.circle().radius(5);T.cx(M),T.cy(E),T.fill("#1A237E"),T.attr("id","step-circle-"+O),_.push([M],[E]),O++}k.polyline(_).fill("transparent").stroke({width:3,color:"#1A237E"}).back(),$(".route-steps").empty();for(var A=1,C=0,P=l;C<P.length;C++){var j=P[C],N=document.createElement("div"),L=document.createElement("span"),V="<span class='sr-only'>Paso número "+A+".</span>";switch(1==j.poi&&(V+="Tienes "+j.poiname+" a la "+(1==j.poidirection?"izquierda":"derecha")+". "),j.direction){case 0:V+='Camina <span class="steps-expression" data-steps=\''+Math.ceil(j.distance)+"'>"+Math.ceil(j.distance)+" pasos</span> hacia delante";break;case 1:V+='Gira a la izquierda y camina <span class="steps-expression" data-steps=\''+Math.ceil(j.distance)+"'>"+Math.ceil(j.distance)+" pasos</span>";break;case 2:V+='Gira a la derecha y camina <span class="steps-expression" data-steps=\''+Math.ceil(j.distance)+"'>"+Math.ceil(j.distance)+" pasos</span>";break;case-1:V+="Has llegado a tu destino"}$(L).html(V),$(N).append(L),$(N).addClass("route-step"),$(N).attr("role","listitem"),$(N).attr("tabindex","0"),$(N).attr("data-step",A),$(N).attr("data-map-rotation",u),$(".route-steps").append(N),A++}$("#metricUnitSelect").on("change",function(t){$(".steps-expression").each(function(){var t=parseInt($(this).attr("data-steps"));if(0==$("#metricUnitSelect").val())$(this).html(t+" pasos");else{var e=t/2;$(this).html(e+" metros")}})}),$(".route-steps .route-step").on("focus",function(t){var e=l[parseInt($(this).attr("data-step"))-1];$("#map svg #SVG_MAIN_CONTENT, .map-marker").css({"transform-origin":e.vcenterx+"px "+e.vcentery+"px"}),$("#map svg #SVG_MAIN_CONTENT .map-marker").each(function(t){$(this).css({"transform-origin":$(this).find("text").attr("x")+"px "+$(this).find("text").attr("y")+"px"})}),c.a.instance.zoomAndMove(e.vcenterx,e.vcentery,15,!1)}),$(".route-steps:not(.route-orientation) .route-step:first-child").trigger("focus"),$(".route-steps:not(.route-orientation) .route-step:first-child").trigger("focus")}(t.data),0!=$("#impairmentSelect").val()&&0==t.disability?($("#nonAccessibleWarning").css("display","block"),$("#nonAccessibleWarning").html($("#nonAccessibleWarning").html())):$("#nonAccessibleWarning").css("display","none")})}),$(".focus-location button").on("click",function(t){t.preventDefault(),(new u.a).getCurrentPosition(function(t,e){var n=proj4("EPSG:4326","EPSG:25830",[e,t]),a=n[0],r=n[1];c.a.instance.moveTo(a,-r)})}),$(".focus-orientation button").on("click",function(t){t.preventDefault(),$(".route-orientation:first-child").trigger("focus")});var v=4;new MutationObserver(function(t){for(var e=0,n=t;e<n.length;e++){var a=n[e];if("attributes"===a.type){var r=a.target;if("orientationg"===$(r).attr("id")){if(4!=v)return void v++;v=0;for(var i=$(r).attr("data-orientation"),o=parseFloat($(r).attr("data-x")),s=parseFloat($(r).attr("data-y")),c={},l=-1;l<3;l++){var u=h(o,s,i+10*l);null!=u&&(void 0==c[u]?c[u]=1:c[u]=c[u]+1)}for(var d=null,p=0,f=0,g=Object.keys(c);f<g.length;f++){var m=g[f];c[m]>p&&(p=c[m],d=m)}var b=d;if($(".route-steps .route-orientation").remove(),null!=b&&void 0!=b){var y=document.createElement("div"),w=document.createElement("span"),x="<span class='sr-only'>Información sobre tu orientación.</span>\n                            Estás mirando hacia "+$("#"+b).attr("data-name")+".\n                        ";$(w).html(x),$(y).append(w),$(y).addClass("route-step route-orientation"),$(y).attr("role","listitem"),$(y).attr("tabindex","0"),$(y).attr("data-step",-1),$(".route-steps").prepend(y)}}}}}).observe($(c.a.instance.container).get(0),{attributes:!0,childList:!1,subtree:!0})})}]);