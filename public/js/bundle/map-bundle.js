!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.ZOOM_LEVEL_BASE=.000246153846,this.ZOOM_LEVEL_STEP=.4514682741,this.MAX_GROUP_LEVEL=4,this._svg=SVG("map"),this._svg.attr("version","1.1"),this._svg.attr("role","graphics-document document"),this._zoomlevel=3,this._container="#map svg ",this.guides_drawn=!1,this.marker_groups=Array.apply(null,Array(20)).map(function(t){return[]}),this.auto_marker_groups=Array.apply(null,Array(20)).map(function(t){return[]}),this.auto_grouped_buildings=[]}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svg",{get:function(){return this._svg},set:function(t){this._svg=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomlevel",{get:function(){return this._zoomlevel},set:function(t){this._zoomlevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t},enumerable:!0,configurable:!0}),t.prototype.fetchData=function(){var t=this;if(void 0===this._data){var e=Cookies.get("locationRadio")||100;return $.getJSON("/map/data/"+e,function(t){return t})}new Promise(function(e,n){e(t._data)})},Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guidesDrawn",{get:function(){return this.guides_drawn},set:function(t){this.guides_drawn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullw",{get:function(){return this.svg.viewbox().width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullh",{get:function(){return this.svg.viewbox().height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDrawn",{set:function(t){this.onmapdrawn=t},enumerable:!0,configurable:!0}),t.prototype.drawGuides=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){$(this.container+".jails").remove();for(var t=this.svg.group().addClass("jails").back(),e=this.zoomlevel,n=100/e+"%",a=this.svg.viewbox(),o=a.x,i=a.y,r=this.fullw/e,s=this.fullh/e,c=0;c<e;c++)for(var l=0;l<e;l++)t.rect(n,n).move(o+c*r,i+l*s).fill("transparent").stroke({width:0})}},t.prototype.calculateAutoGroups=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){this.drawGuides();for(var t=0,e=this.svg.select(".jails rect").members;t<e.length;t++){for(var n=e[t],a=!1,o=0;o<this.data.groups[this.zoomlevel].length;o++){var i=this.data.groups[this.zoomlevel][o];if(n.inside(i.lat,i.long)){a=!0;break}}if(!a){var r=0,s=void 0;for(o=0;o<this.data.buildings.length;o++){var c=this.data.buildings[o],l=c.centerx,u=c.centery;n.inside(l,u)&&-1==c.groups.indexOf(this.zoomlevel)&&(r++,-1==this.marker_groups[this.zoomlevel].indexOf(parseInt(c.properties.id.value))&&this.marker_groups[this.zoomlevel].push(parseInt(c.properties.id.value)),(void 0==s||parseInt(c.properties.priority.value)<parseInt(s.properties.priority.value))&&(s=c))}0!=r&&this.data.groups[this.zoomlevel].push({id:parseInt(s.centerx).toString()+parseInt(s.centery).toString(),affects:r,lat:s.centerx,long:s.centery,name:"Marcadores cerca de "+s.properties.name.value,radius:n.width()/2,auto:!0})}}}},t.prototype.draw=function(){var t=this;this.fetchData().then(function(e){t.data=e,t.svg.attr("id","this.svg_MAIN"),t.svg.attr("preserveAspectRatio","xMidYMid slice"),t.svg.attr("class","map-dragable"),t.svg.attr("tabindex",0);for(var n=t.svg.group().attr("id","SVG_MAIN_CONTENT").front(),a=function(e){var a=n.group().link("#feature-"+e.properties.id.value).attr("class","non-link building-wrapper feature-object").attr("id","link-feature-"+e.properties.id.value);a.attr("data-building",e.properties.id.value),a.attr("role","graphics-symbol img"),a.attr("data-name",e.properties.name.value),a.attr("data-coords",e.centerx+":"+e.centery),a.attr("data-description",e.properties.description.value),a.attr("data-nearest",e.nearestnames.reduce(function(t,e){return t+","+e})),a.attr("data-nearest-radius",e.nearestnamesradius);var o=a.path().attr("d",e.path);o.attr("id","feature-shape-"+e.properties.id.value),o.attr("class","building");var i=a.group().attr("id","marker-"+e.properties.id.value).attr("class","map-marker"),r=i.image("/images/building_marker.svg",14,14);r.attr("class","marker"),r.attr("x",e.centerx-15),r.attr("y",e.centery-7);var s=i.text(function(t){for(var n=e.properties.name.value.split(" "),a=[n[0]],o=1;o<n.length;o++){var i=n[o];a[a.length-1].length+i.length<=10||null!=i.match(/^(,|.|;|:|")$/i)?a[a.length-1]+=" "+i:a.push(i)}for(o=0;o<a.length;o++)0==o?t.tspan(a[o]):t.tspan(a[o]).move(e.centerx,e.centery).dy(5*o)});s.attr("text-anchor","start"),s.attr("id","label-"+(e.properties.id?e.properties.id.value:"")),s.attr("x",e.centerx),s.attr("y",e.centery),s.font({weight:"bold"}),a.attr("aria-labelledby","label-"+e.properties.id.value);for(var c=0,l=e.groups;c<l.length;c++){var u=l[c];t.marker_groups[u].push(e.properties.id.value)}},o=0,i=t.data.buildings;o<i.length;o++){a(i[o])}t.onmapdrawn()})},t.prototype.drawLocation=function(t,e){console.log("Location update",t,e);var n=$(this.container+"#locationg");if(0==n.length){var a=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();a.attr("id","locationg");var o=a.circle().radius(10);o.cx(t).cy(e),o.fill("deeppink")}else n.find("circle").attr("cx",t),n.find("circle").attr("cy",e)},t.prototype.drawOrientation=function(e,n,a){var o=$(this.container+"#orientationg");if(0==o.length){var i=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();i.attr("id","orientationg");var r=i.image("/images/arrow.svg");r.move(e-8,n-24),r.attr("width",16),r.attr("height",16)}else o.find("image").attr("x",e-8),o.find("image").attr("y",n-24);var s=a<0?a+360:a;$(t.instance.container+"#orientationg image").css({"transform-origin":e+"px "+n+"px",transform:"rotateZ("+(270-s)+"deg)"}),o.attr("data-orientation",270-s),o.attr("data-x",e),o.attr("data-y",n)},t.prototype.groupMarkers=function(t){var e=0;this.calculateAutoGroups();for(var n=[],a=0,o=this.marker_groups;a<o.length;a++){for(var i=0,r=o[a];i<r.length;i++){var s=r[i];e==t?n.push(s):($("#link-feature-"+s).removeAttr("tabindex"),$("#link-feature-"+s).removeClass("non-clickable"),this.svg.select("#marker-"+s).show())}for(var c=0,l=this.data.groups[e];c<l.length;c++){var u=l[c];if(e==t){var d=1==u.affects.toString().length?1:u.affects.toString().length/2,p=this.svg.select("#SVG_MAIN_CONTENT").members[0].link("#gmarker-"+u.id).attr("class","non-link gmarker").attr("id","gmarker-"+u.id);p.attr("data-name",u.name);var v=p.group(),h=v.circle().radius(10);h.cx(u.lat).cy(u.long);var f=v.plain(u.affects).attr("text-anchor","middle");f.font({size:16/d}),f.move(u.lat,u.long-8/d),p.title(u.name).attr("id","gmarker-"+u.id+"-title"),p.attr("aria-labelledby","gmarker-"+u.id+"-title"),p.attr("data-coords",h.cx()+":"+h.cy()),f.attr("aria-hidden","true"),f.attr("role","presentation")}else for(var m=0,g=this.svg.select("#gmarker-"+u.id).members;m<g.length;m++){g[m].remove()}}e++}for(var b=0,y=n;b<y.length;b++){s=y[b];this.svg.select("#marker-"+s).hide(),$("#link-feature-"+s).attr("tabindex","-1"),$("#link-feature-"+s).addClass("non-clickable")}var w=this;$(this.container+"a.gmarker").on("focus",function(){$(this).on("keyup",function(t){if(13==t.which){t.preventDefault(),w.zoomlevel+=2;var e=$(this).attr("data-coords").split(":"),n=e[0],a=e[1];w.zoomAndMove(n,a,w.zoomlevel)}})}),$(this.container+"a.gmarker").on("click",function(t){t.preventDefault(),w.zoomlevel+=2;var e=$(this).attr("data-coords").split(":"),n=e[0],a=e[1];w.zoomAndMove(n,a,w.zoomlevel)}),this.updateSidebar()},t.prototype.isInview=function(e){var n=t.instance.svg.viewbox().x,a=t.instance.svg.viewbox().y,o=n+t.instance.svg.viewbox().width,i=a+t.instance.svg.viewbox().height,r=$(e).attr("data-coords"),s=parseFloat(r.split(":")[0]),c=parseFloat(r.split(":")[1]);return s>=n&&s<=o&&(c>=a&&c<=i)},t.prototype.updateSidebar=function(){var t=this;$("#currentViewPanel ul").empty(),this.zoomlevel<this.MAX_GROUP_LEVEL?$(this.container+".gmarker").each(function(e,n){var a=t.isInview(n);if($(n).attr("data-inview",String(a)),a){var o=$(n).attr("data-name"),i=$(n).attr("data-coords").split(":")[0],r=$(n).attr("data-coords").split(":")[1],s=document.createElement("li"),c=document.createElement("a");$(c).html("Grupo: "+o),$(c).attr("href","#"),$(c).attr("data-type","group"),$(c).attr("data-listened",String(!1)),$(c).attr("data-x",i),$(c).attr("data-y",r),$(s).append(c),$("#currentViewPanel ul").append(s)}}):$(this.container+"a.feature-object").each(function(e,n){var a=t.isInview(n);if($(t).attr("data-inview",String(a)),a){var o=$(n).attr("data-coords"),i=parseFloat(o.split(":")[0]),r=parseFloat(o.split(":")[1]),s=document.createElement("li"),c=document.createElement("a");$(c).html("Edificio: "+$(n).attr("data-name")),$(c).attr("href","#"),$(c).attr("data-id",$(n).attr("data-id")),$(c).attr("data-x",i),$(c).attr("data-y",r),$(s).append(c),$("#currentViewPanel ul").append(s)}})},t.prototype.getZoomValues=function(t,e){var n=$("#map").width();return{vbx:n/=this.ZOOM_LEVEL_BASE+(t-1)*this.ZOOM_LEVEL_STEP,wdiff:e?(this.svg.viewbox().width-n)/2:0}},t.prototype.resizeToLevel=function(t,e){var n=this;if(void 0===e&&(e=!0),!(t<2||t>21)){$(this.container+".jails").remove(),this.zoomlevel=t;var a=this.getZoomValues(t,e),o=a.vbx,i=a.wdiff;(e?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+i,this.svg.viewbox().y+i,o,o),window.location.href="#zoom="+t,setTimeout(function(){n.groupMarkers(t),n.updateSidebar()},400)}},t.prototype.move=function(t,e,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+t,this.svg.viewbox().y+e,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},t.prototype.moveTo=function(t,e,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(t-this.fullw/2,e-this.fullh/2,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},t.prototype.zoomAndMove=function(t,e,n,a){var o=this;void 0===a&&(a=!0),$(this.container+".jails").remove(),this.zoomlevel=n;var i=this.getZoomValues(n,!0),r=i.vbx,s=i.wdiff;(a?this.svg.animate({duration:250}):this.svg).viewbox(t-this.fullw/2+s,e-this.fullh/2+s,r,r),window.location.href="#zoom="+n,setTimeout(function(){o.groupMarkers(n),o.updateSidebar()},400)},t}();e.SVGMap=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(2),i=n(3),r=function(){function t(){this.voice=new o.SVGVoiceControls,proj4.defs("EPSG:25830","+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs")}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.pageLoad=function(){a.SVGMap.instance.onDrawn=function(){setTimeout(function(){a.SVGMap.instance.groupMarkers(a.SVGMap.instance.zoomlevel)},100);var t=null,e=new i.SVGLocation;e.watch(function(e,n){var o=proj4("EPSG:4326","EPSG:25830",[n,e]),i=o[0],r=o[1];t={x:i,y:-r},a.SVGMap.instance.drawLocation(i,-r)}),e.watchOrientation(function(e,n,o){null!=t&&a.SVGMap.instance.drawOrientation(t.x,t.y,e)}),a.SVGMap.instance.updateSidebar()},a.SVGMap.instance.draw()},Object.defineProperty(t.prototype,"voiceControl",{get:function(){return this.voice},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSearchVoiceQuery",{get:function(){return this.searchResultCallback},set:function(t){this.searchResultCallback=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSearchResultSelected",{get:function(){return this.searchResultSelected},set:function(t){this.searchResultSelected=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRouteCommand",{get:function(){return this.routeCommand},set:function(t){this.routeCommand=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onUnknownVoiceCommand",{get:function(){return this.uvc},set:function(t){this.uvc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchResultsForVoiceSelection",{get:function(){return this.srfvs},set:function(t){this.srfvs=t},enumerable:!0,configurable:!0}),t.prototype.startVoice=function(){var t=this;o.SVGVoiceControls.compatible()&&(o.SVGVoiceControls.setOn(!0),this.voice.start(function(e){var n=e.confidence,a=e.transcript;console.log("Voice received:"),console.log(n,a);var o=t.voice.parseAction(a);if(o)switch(console.log("Parsed as",o),o.name){case"unknown":return void t.onUnknownVoiceCommand();case"search":return void t.onSearchVoiceQuery(o.query);case"select":return void t.onSearchResultSelected(t.toDigit(o.item));case"route":return void t.onRouteCommand({origin:o.origin,target:o.target});case"access-routes":return void t.onRouteCommand(null);case"zoom":return void t.navigationHandler("acercar"===o.direction?"zoom-in":"zoom-out");default:return void t.navigationHandler(o.direction)}}))},t.prototype.stopVoice=function(){o.SVGVoiceControls.compatible()&&void 0!==this.voice&&(o.SVGVoiceControls.setOn(!1),this.voice.stop())},t.prototype.navigationHandler=function(t){var e=20-a.SVGMap.instance.zoomlevel+15,n=0,o=0;switch(t){case"up":o=-e;break;case"down":o=e;break;case"left":n=-e;break;case"right":n=e;break;case"zoom-in":return a.SVGMap.instance.zoomlevel=20==a.SVGMap.instance.zoomlevel?a.SVGMap.instance.zoomlevel:a.SVGMap.instance.zoomlevel+1,void a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel);case"zoom-out":return a.SVGMap.instance.zoomlevel=1==a.SVGMap.instance.zoomlevel?a.SVGMap.instance.zoomlevel:a.SVGMap.instance.zoomlevel-1,void a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel)}a.SVGMap.instance.move(n,o)},t.prototype.toDigit=function(t){var e=["uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez"];console.log(e.length,t);for(var n=0;n<e.length;n++)if(e[n]==t)return n+1;return-1},t}();e.SVGControls=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(5),o=function(){function t(){this.time_per_word=500,t.compatible()&&(this.list=new webkitSpeechGrammarList,this.list.addFromString(""),this.voice=new webkitSpeechRecognition,this.voice.lang="es-ES",this.voice.interimResults=!1,this.voice.maxAlternatives=1,this.voice.grammars=this.list,this.voice.continuous=!0),this.container=document.getElementById("speech")}return t.compatible=function(){return"undefined"!=typeof SpeechRecognition||"undefined"!=typeof webkitSpeechRecognition},t.isOn=function(){return this.on},t.setOn=function(t){this.on=t},t.prototype.say=function(e){var n=this,a=t.isOn();t.setOn(!1),this.stop(),this.container.innerHTML="",this.container.innerHTML=e,setTimeout(function(){t.setOn(a),n.start(n.onTranscript)},this.time_per_word*e.split(" ").length)},t.prototype.start=function(e){var n=this;if(console.log(t.isOn()),t.isOn()){this.onTranscript=e,this.voice.onresult=function(t){n.voice.stop();var a=t.results.length-1,o=t.results[a][0].transcript,i=t.results[a][0].confidence;i>=.75?e({confidence:i,transcript:o}):(console.log("Ignoring because of low confidence:"),console.log("("+i+") "+o))},this.voice.onend=function(){var n=this;console.log("Voice end and on="+t.isOn()),t.isOn()&&setTimeout(function(){n.start(e)},1e3)};try{this.voice.start()}catch(t){}console.log("Voice started...")}},t.prototype.stop=function(){this.voice.stop()},t.prototype.parseAction=function(t){var e=a.voiceParse(t);if(console.log(e),"move"==e.name)switch(e.direction){case"la derecha":e.direction="right";break;case"la izquierda":e.direction="left";break;case"arriba":e.direction="up";break;case"abajo":e.direction="down";break;default:e.direction=null}else if("zoom"===e.action)switch(e.direction){case"alejar":e.direction="zoom-out";break;case"acercar":e.direction="zoom-in";break;default:e.direction=null}return e},t.on=!1,t}();e.SVGVoiceControls=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.orientationAccum=0}return t.prototype.isGeolocationAvailable=function(){return"geolocation"in navigator},t.prototype.watch=function(t){this.isGeolocationAvailable()&&navigator.geolocation.watchPosition(function(e){t(e.coords.latitude,e.coords.longitude)},function(t){console.log("[LOCATION WATCH] error",t)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},t.prototype.getCurrentPosition=function(t){navigator.geolocation.getCurrentPosition(function(e){t(e.coords.latitude,e.coords.longitude)},function(t){console.log("[LOCATION GET] error",t)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},t.prototype.watchOrientation=function(t){var e=this;window.addEventListener("deviceorientation",function(n){50==e.orientationAccum?(e.orientationAccum=0,t(n.alpha,n.beta,n.gamma)):e.orientationAccum++})},t}();e.SVGLocation=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),o=n(1);$(document).ready(function(){window.gsvg=a.SVGMap.instance.svg,o.SVGControls.instance.pageLoad(),a.SVGMap.instance.moveTo(717444.93870502,-4251399.25399798);var t=!1;$("body").not("input").not("textarea").keydown(function(e){if(t=t||18==e.which){var n="";switch(e.which){case 189:case 171:n="zoom-out";break;case 187:case 173:n="zoom-in";break;case 38:n="up";break;case 40:n="down";break;case 37:n="left";break;case 39:n="right"}o.SVGControls.instance.navigationHandler(n)}}),$("body").not("input").not("textarea").keyup(function(e){18==e.which&&(t=!1)});var e,n,i=!1,r=!1,s="ontouchstart"in window?"touchmove":"mousemove",c="ontouchstart"in window?"touchend":"mouseup",l="ontouchstart"in window?"touchstart":"mousedown",u=$(a.SVGMap.instance.container).get(0).getScreenCTM();console.log(u),$(a.SVGMap.instance.container).on(l,function(t){t.preventDefault(),i=!("ontouchstart"in window)||1==t.touches.length,e="ontouchstart"in window?t.targetTouches[0].pageX:t.pageX,n="ontouchstart"in window?t.targetTouches[0].pageY:t.pageY}),$(a.SVGMap.instance.container).on(c,function(t){r&&a.SVGMap.instance.groupMarkers(a.SVGMap.instance.zoomlevel),i=!1}),$(a.SVGMap.instance.container).on(s,function(t){if(i){var o="ontouchstart"in window?t.targetTouches[0].pageX:t.pageX,s="ontouchstart"in window?t.targetTouches[0].pageY:t.pageY,c=(o-e)/-35,l=(s-n)/-35;a.SVGMap.instance.move(c,l,!1),r=!0}});var d,p=!1;$(a.SVGMap.instance.container).on("mousewheel DOMMouseScroll",function(t){if(t.preventDefault(),!p){var e="number"==typeof t.originalEvent.detail&&0!==t.originalEvent.detail?t.originalEvent.detail:t.originalEvent.wheelDelta;console.log("wheel",e),e>0?a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel+1,!0):a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel-1,!0),p=!0,setTimeout(function(){return p=!1},400)}});var v=!1;$(a.SVGMap.instance.container).on("touchstart",function(t){2==t.touches.length&&(v=!0,d=Math.abs(t.touches[0].pageX-t.touches[1].pageX))}),$(a.SVGMap.instance.container).not("a").on("touchmove",function(t){(t.preventDefault(),v&&!p&&2==t.touches.length)&&(Math.abs(t.touches[0].pageX-t.touches[1].pageX)>d?(a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel+1,!0),p=!0):(a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel-1,!0),p=!0),setTimeout(function(){return p=!1},400))})})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=[{name:"antiloop",pattern:/(No te he entendido)|(El mapa está ahora escuchando)/i,extract:[]},{name:"move",pattern:/(mover) (mapa |mapas |plano )?(a |hacia |para )?(la derecha|la izquierda|arriba|abajo)/i,extract:[{name:"direction",position:4}]},{name:"zoom",pattern:/(alejar|acercar)( mapa)?/i,extract:[{name:"direction",position:1}]},{name:"search",pattern:/(buscar) ([\w | \d]+)+/i,extract:[{name:"query",position:2}]},{name:"select",pattern:/(seleccionar |elegir |escoger |ver )(número |resultado )*(\w+)+/i,extract:[{name:"item",position:3}]},{name:"access-routes",pattern:/i((acceder a)|(acceso a)|(ir a)) (((cálculo de)|(calcular)|(calculo de))+ )*(ruta)/i,extract:[]},{name:"route",pattern:/((ir )|(calcular ruta ))*desde ((\w|\d| )+) hasta ((\w|\d| )+)/i,extract:[{name:"origin",position:4},{name:"target",position:6}]}];e.voiceParse=function(t){for(var e=0,n=a;e<n.length;e++){var o=n[e],i=t.match(o.pattern);if(null!=i){for(var r={name:o.name},s=0,c=o.extract;s<c.length;s++){var l=c[s];r[l.name]=i[l.position]}return r}}return{name:"unknown"}}},,function(t,e,n){n(4),t.exports=n(8)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=n(9),i=n(2),r=n(0);$(document).ready(function(){loadSettings(),$("form[action='']").on("submit",function(t){t.preventDefault()}),$("#pad .btn").click(function(t){t.preventDefault(),a.SVGControls.instance.navigationHandler($(this).attr("data-map-nav"))}),$("#searchform").on("submit",function(t){t.preventDefault();var e=$("#queryTxt").val();o.search(e)}),i.SVGVoiceControls.compatible()&&($("#voicePanel").css("display","block"),a.SVGControls.instance.onSearchVoiceQuery=function(t){console.log(t),o.search(t,!0)},a.SVGControls.instance.onUnknownVoiceCommand=function(){a.SVGControls.instance.voiceControl.say("No te he entendido.")},a.SVGControls.instance.onRouteCommand=function(t){null!=t||(window.location.href="/route")},$("#dictateBtn").on("click",function(t){t.preventDefault(),"true"==$(this).attr("data-dictating")?(a.SVGControls.instance.stopVoice(),$(this).attr("data-dictating","false"),$(this).removeClass("active"),$("#dictateStatus").html("Haz click para comenzar a escuchar"),a.SVGControls.instance.voiceControl.say("El mapa ha dejado de escuchar.")):(a.SVGControls.instance.startVoice(),$(this).attr("data-dictating","true"),$(this).addClass("active"),$("#dictateStatus").html("Escuchando..."),a.SVGControls.instance.voiceControl.say("El mapa está ahora escuchando.")),$(this).blur()})),new MutationObserver(function(t){for(var e=0,n=t;e<n.length;e++)for(var a=0,i=n[e].addedNodes;a<i.length;a++){var r=i[a];"true"!=$(r).find("a.building-wrapper").attr("data-listened")&&($(r).find("a.building-wrapper").on("click",function(t){$(this).hasClass("non-clickable")||o.showBuildingInfo($(this).attr("data-building"))}),$(r).find("a.building-wrapper").on("focus",function(t){var e=$(this).attr("data-building"),n=$(this).attr("data-coords").split(":"),a=n[0],i=n[1];o.focusBuilding(e,a,i,!1)}),$(r).find("a.building-wrapper").attr("data-listened","true"))}}).observe($(r.SVGMap.instance.container).get(0),{attributes:!1,childList:!0,subtree:!0}),new MutationObserver(function(t){for(var e=0,n=t;e<n.length;e++)for(var a=function(t){var e=$(t).find("a");"true"!=$(e).attr("data-listened")&&("group"==$(e).attr("data-type")?$(e).on("click",function(t){t.preventDefault(),r.SVGMap.instance.zoomlevel+=2,r.SVGMap.instance.zoomAndMove($(e).attr("data-x"),$(e).attr("data-y"),r.SVGMap.instance.zoomlevel)}):$(e).on("click",function(t){t.preventDefault(),o.focusBuilding($(e).attr("data-id"),$(e).attr("data-x"),$(e).attr("data-y"),!1)}),$(e).attr("data-listened","true"))},i=0,s=n[e].addedNodes;i<s.length;i++){a(s[i])}}).observe($("#currentViewPanel ul").get(0),{attributes:!1,childList:!0,subtree:!1})})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=n(0);function i(t,e,n,a){void 0!=e&&void 0!=n?(o.SVGMap.instance.zoomAndMove(e,n,7),r(t)):void 0!==a&&a.say("No se ha podido seleccionar ese resultado.")}function r(t){$.get("/map/data/b/"+t,function(t){for(var e in $("#dataPanel").css("display","block"),$("#resultsPanel").css("display","none"),$("#dataPanel table").empty(),t)if(t[e].userinterest){var n=document.createElement("tr"),a=document.createElement("th"),o=document.createElement("td");$(a).html(t[e].display),$(o).html(t[e].value),$(n).append(a),$(n).append(o),$("#dataPanel table").prepend(n)}})}e.search=function(t,e){void 0===e&&(e=!1),$.getJSON("/map/data/s/name/"+t,function(n){var o=n.results;console.log(o),$("#dataPanel").css("display","none"),$("#resultsPanel").css("display","block"),$("#resultsPanel table").empty();for(var r=1,s="Estos son los resultados para la búsqueda "+t,c=0,l=o;c<l.length;c++){var u=l[c],d=document.createElement("tr"),p=document.createElement("th"),v=document.createElement("td"),h=document.createElement("button");$(h).addClass("btn btn-success result-view").html("Ir").attr("aria-label","Ver en el mapa "+u.name+"."),$(h).attr("data-centerx",u.centerx).attr("data-centery",u.centery),$(h).attr("data-result-id",r),$(h).attr("data-feature-id",u.id),$(v).append(h),$(p).html(u.name),$(d).append(p),$(d).append(v),$("#resultsPanel table").append(d),e&&(s+="\n Resultado número "+r+": "+u.name),r++}e&&(s+="\n Selecciona un resultado para verlo en el mapa.",a.SVGControls.instance.onSearchResultSelected=function(t){var e=$(".result-view[data-result-id='"+t+"']").attr("data-centerx"),n=$(".result-view[data-result-id='"+t+"']").attr("data-centery");i($(".result-view[data-result-id='"+t+"']").attr("data-feature-id"),e,n,a.SVGControls.instance.voiceControl)},a.SVGControls.instance.voiceControl.say(s)),$("#data-status").html("Búsqueda de '"+t+"'"),$("#resultsPanel").trigger("focus"),$("button.result-view").on("click",function(t){t.preventDefault();var e=$(this).attr("data-centerx"),n=$(this).attr("data-centery");i($(this).attr("data-feature-id"),e,n)})})},e.focusBuilding=i,e.showBuildingInfo=r}]);