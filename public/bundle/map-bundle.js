!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.ZOOM_LEVEL_BASE=.000246153846,this.ZOOM_LEVEL_STEP=.4514682741,this.MAX_GROUP_LEVEL=4,this._svg=SVG("map"),this._svg.attr("version","1.1"),this._svg.attr("role","graphics-document document"),this._zoomlevel=3,this._container="#map svg ",this.guides_drawn=!1,this.marker_groups=Array.apply(null,Array(20)).map(function(e){return[]}),this.auto_marker_groups=Array.apply(null,Array(20)).map(function(e){return[]}),this.auto_grouped_buildings=[]}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"svg",{get:function(){return this._svg},set:function(e){this._svg=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomlevel",{get:function(){return this._zoomlevel},set:function(e){this._zoomlevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},set:function(e){this._container=e},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;if(void 0===this._data){var t=Cookies.get("locationRadio")||100;return $.getJSON("/map/data/"+t,function(e){return e})}new Promise(function(t,n){t(e._data)})},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"guidesDrawn",{get:function(){return this.guides_drawn},set:function(e){this.guides_drawn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullw",{get:function(){return this.svg.viewbox().width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullh",{get:function(){return this.svg.viewbox().height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDrawn",{set:function(e){this.onmapdrawn=e},enumerable:!0,configurable:!0}),e.prototype.drawGuides=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){$(this.container+".jails").remove();for(var e=this.svg.group().addClass("jails").back(),t=this.zoomlevel,n=100/t+"%",a=this.svg.viewbox(),o=a.x,i=a.y,r=this.fullw/t,s=this.fullh/t,c=0;c<t;c++)for(var l=0;l<t;l++)e.rect(n,n).move(o+c*r,i+l*s).fill("transparent").stroke({width:0})}},e.prototype.calculateAutoGroups=function(){if(!(this.zoomlevel>=this.MAX_GROUP_LEVEL)){this.drawGuides();for(var e=0,t=this.svg.select(".jails rect").members;e<t.length;e++){for(var n=t[e],a=!1,o=0;o<this.data.groups[this.zoomlevel].length;o++){var i=this.data.groups[this.zoomlevel][o];if(n.inside(i.lat,i.long)){a=!0;break}}if(!a){var r=0,s=void 0;for(o=0;o<this.data.buildings.length;o++){var c=this.data.buildings[o],l=c.centerx,u=c.centery;n.inside(l,u)&&-1==c.groups.indexOf(this.zoomlevel)&&(r++,-1==this.marker_groups[this.zoomlevel].indexOf(parseInt(c.properties.id.value))&&this.marker_groups[this.zoomlevel].push(parseInt(c.properties.id.value)),(void 0==s||parseInt(c.properties.priority.value)<parseInt(s.properties.priority.value))&&(s=c))}0!=r&&this.data.groups[this.zoomlevel].push({id:parseInt(s.centerx).toString()+parseInt(s.centery).toString(),affects:r,lat:s.centerx,long:s.centery,name:"Marcadores cerca de "+s.properties.name.value,radius:n.width()/2,auto:!0})}}}},e.prototype.draw=function(){var e=this;this.fetchData().then(function(t){e.data=t,e.svg.attr("id","this.svg_MAIN"),e.svg.attr("preserveAspectRatio","xMidYMid slice"),e.svg.attr("class","map-dragable"),e.svg.attr("tabindex",0);for(var n=e.svg.group().attr("id","SVG_MAIN_CONTENT").front(),a=function(t){var a=n.group().link("#feature-"+t.properties.id.value).attr("class","non-link building-wrapper feature-object").attr("id","link-feature-"+t.properties.id.value);a.attr("data-building",t.properties.id.value),a.attr("role","graphics-symbol img"),a.attr("data-name",t.properties.name.value),a.attr("data-coords",t.centerx+":"+t.centery),a.attr("data-description",t.properties.description.value),a.attr("data-nearest",t.nearestnames.reduce(function(e,t){return e+","+t})),a.attr("data-nearest-radius",t.nearestnamesradius);var o=a.path().attr("d",t.path);o.attr("id","feature-shape-"+t.properties.id.value),o.attr("class","building");var i=a.group().attr("id","marker-"+t.properties.id.value).attr("class","map-marker"),r=i.image("/images/building_marker.svg",14,14);r.attr("class","marker"),r.attr("x",t.centerx-15),r.attr("y",t.centery-7);var s=i.text(function(e){for(var n=t.properties.name.value.split(" "),a=[n[0]],o=1;o<n.length;o++){var i=n[o];a[a.length-1].length+i.length<=10||null!=i.match(/^(,|.|;|:|")$/i)?a[a.length-1]+=" "+i:a.push(i)}for(o=0;o<a.length;o++)0==o?e.tspan(a[o]):e.tspan(a[o]).move(t.centerx,t.centery).dy(5*o)});s.attr("text-anchor","start"),s.attr("id","label-"+(t.properties.id?t.properties.id.value:"")),s.attr("x",t.centerx),s.attr("y",t.centery),s.font({weight:"bold"}),a.attr("aria-labelledby","label-"+t.properties.id.value);for(var c=0,l=t.groups;c<l.length;c++){var u=l[c];e.marker_groups[u].push(t.properties.id.value)}},o=0,i=e.data.buildings;o<i.length;o++){a(i[o])}e.onmapdrawn()})},e.prototype.drawLocation=function(e,t){console.log("Location update",e,t);var n=$(this.container+"#locationg");if(0==n.length){var a=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();a.attr("id","locationg");var o=a.circle().radius(10);o.cx(e).cy(t),o.fill("deeppink")}else n.find("circle").attr("cx",e),n.find("circle").attr("cy",t)},e.prototype.drawOrientation=function(t,n,a){var o=$(this.container+"#orientationg");if(0==o.length){var i=this.svg.select("#SVG_MAIN_CONTENT").members[0].group().front();i.attr("id","orientationg");var r=i.image("/images/arrow.svg");r.move(t-8,n-24),r.attr("width",16),r.attr("height",16)}else o.find("image").attr("x",t-8),o.find("image").attr("y",n-24);var s=a<0?a+360:a;$(e.instance.container+"#orientationg image").css({"transform-origin":t+"px "+n+"px",transform:"rotateZ("+(270-s)+"deg)"}),o.attr("data-orientation",270-s),o.attr("data-x",t),o.attr("data-y",n)},e.prototype.groupMarkers=function(e){var t=0;this.calculateAutoGroups();for(var n=[],a=0,o=this.marker_groups;a<o.length;a++){for(var i=0,r=o[a];i<r.length;i++){var s=r[i];t==e?n.push(s):($("#link-feature-"+s).removeAttr("tabindex"),$("#link-feature-"+s).removeClass("non-clickable"),this.svg.select("#marker-"+s).show())}for(var c=0,l=this.data.groups[t];c<l.length;c++){var u=l[c];if(t==e){var d=1==u.affects.toString().length?1:u.affects.toString().length/2,p=this.svg.select("#SVG_MAIN_CONTENT").members[0].link("#gmarker-"+u.id).attr("class","non-link gmarker").attr("id","gmarker-"+u.id);p.attr("data-name",u.name);var v=p.group(),h=v.circle().radius(10);h.cx(u.lat).cy(u.long);var f=v.plain(u.affects).attr("text-anchor","middle");f.font({size:16/d}),f.move(u.lat,u.long-8/d),p.title(u.name).attr("id","gmarker-"+u.id+"-title"),p.attr("aria-labelledby","gmarker-"+u.id+"-title"),p.attr("data-coords",h.cx()+":"+h.cy()),f.attr("aria-hidden","true"),f.attr("role","presentation")}else for(var m=0,g=this.svg.select("#gmarker-"+u.id).members;m<g.length;m++){g[m].remove()}}t++}for(var b=0,y=n;b<y.length;b++){s=y[b];this.svg.select("#marker-"+s).hide(),$("#link-feature-"+s).attr("tabindex","-1"),$("#link-feature-"+s).addClass("non-clickable")}var w=this;$(this.container+"a.gmarker").on("focus",function(){$(this).on("keyup",function(e){if(13==e.which){e.preventDefault(),w.zoomlevel+=2;var t=$(this).attr("data-coords").split(":"),n=t[0],a=t[1];w.zoomAndMove(n,a,w.zoomlevel)}})}),$(this.container+"a.gmarker").on("click",function(e){e.preventDefault(),w.zoomlevel+=2;var t=$(this).attr("data-coords").split(":"),n=t[0],a=t[1];w.zoomAndMove(n,a,w.zoomlevel)}),this.updateSidebar()},e.prototype.isInview=function(t){var n=e.instance.svg.viewbox().x,a=e.instance.svg.viewbox().y,o=n+e.instance.svg.viewbox().width,i=a+e.instance.svg.viewbox().height,r=$(t).attr("data-coords"),s=parseFloat(r.split(":")[0]),c=parseFloat(r.split(":")[1]);return s>=n&&s<=o&&(c>=a&&c<=i)},e.prototype.updateSidebar=function(){var e=this;$("#currentViewPanel ul").empty(),this.zoomlevel<this.MAX_GROUP_LEVEL?$(this.container+".gmarker").each(function(t,n){var a=e.isInview(n);if($(n).attr("data-inview",String(a)),a){var o=$(n).attr("data-name"),i=$(n).attr("data-coords").split(":")[0],r=$(n).attr("data-coords").split(":")[1],s=document.createElement("li"),c=document.createElement("a");$(c).html("Grupo: "+o),$(c).attr("href","#"),$(c).attr("data-type","group"),$(c).attr("data-listened",String(!1)),$(c).attr("data-x",i),$(c).attr("data-y",r),$(s).append(c),$("#currentViewPanel ul").append(s)}}):$(this.container+"a.feature-object").each(function(t,n){var a=e.isInview(n);if($(e).attr("data-inview",String(a)),a){var o=$(n).attr("data-coords"),i=parseFloat(o.split(":")[0]),r=parseFloat(o.split(":")[1]),s=document.createElement("li"),c=document.createElement("a");$(c).html("Edificio: "+$(n).attr("data-name")),$(c).attr("href","#"),$(c).attr("data-id",$(n).attr("data-id")),$(c).attr("data-x",i),$(c).attr("data-y",r),$(s).append(c),$("#currentViewPanel ul").append(s)}})},e.prototype.getZoomValues=function(e,t){var n=$("#map").width();return{vbx:n/=this.ZOOM_LEVEL_BASE+(e-1)*this.ZOOM_LEVEL_STEP,wdiff:t?(this.svg.viewbox().width-n)/2:0}},e.prototype.resizeToLevel=function(e,t){var n=this;if(void 0===t&&(t=!0),!(e<2||e>21)){$(this.container+".jails").remove(),this.zoomlevel=e;var a=this.getZoomValues(e,t),o=a.vbx,i=a.wdiff;(t?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+i,this.svg.viewbox().y+i,o,o),window.location.href="#zoom="+e,setTimeout(function(){n.groupMarkers(e),n.updateSidebar()},400)}},e.prototype.move=function(e,t,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(this.svg.viewbox().x+e,this.svg.viewbox().y+t,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},e.prototype.moveTo=function(e,t,n){var a=this;void 0===n&&(n=!0),(n?this.svg.animate({duration:250}):this.svg).viewbox(e-this.fullw/2,t-this.fullh/2,this.svg.viewbox().width,this.svg.viewbox().height),setTimeout(function(){a.updateSidebar()},400)},e.prototype.zoomAndMove=function(e,t,n,a){var o=this;void 0===a&&(a=!0),$(this.container+".jails").remove(),this.zoomlevel=n;var i=this.getZoomValues(n,!0),r=i.vbx,s=i.wdiff;(a?this.svg.animate({duration:250}):this.svg).viewbox(e-this.fullw/2+s,t-this.fullh/2+s,r,r),window.location.href="#zoom="+n,setTimeout(function(){o.groupMarkers(n),o.updateSidebar()},400)},e}();t.SVGMap=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),i=n(3),r=function(){function e(){this.voice=new o.SVGVoiceControls,proj4.defs("EPSG:25830","+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs")}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.pageLoad=function(){a.SVGMap.instance.onDrawn=function(){setTimeout(function(){a.SVGMap.instance.groupMarkers(a.SVGMap.instance.zoomlevel)},100);var e=null,t=new i.SVGLocation;t.watch(function(t,n){var o=proj4("EPSG:4326","EPSG:25830",[n,t]),i=o[0],r=o[1];e={x:i,y:-r},a.SVGMap.instance.drawLocation(i,-r)}),t.watchOrientation(function(t,n,o){null!=e&&a.SVGMap.instance.drawOrientation(e.x,e.y,t)}),a.SVGMap.instance.updateSidebar()},a.SVGMap.instance.draw()},Object.defineProperty(e.prototype,"voiceControl",{get:function(){return this.voice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSearchVoiceQuery",{get:function(){return this.searchResultCallback},set:function(e){this.searchResultCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSearchResultSelected",{get:function(){return this.searchResultSelected},set:function(e){this.searchResultSelected=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRouteCommand",{get:function(){return this.routeCommand},set:function(e){this.routeCommand=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUnknownVoiceCommand",{get:function(){return this.uvc},set:function(e){this.uvc=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchResultsForVoiceSelection",{get:function(){return this.srfvs},set:function(e){this.srfvs=e},enumerable:!0,configurable:!0}),e.prototype.startVoice=function(){var e=this;o.SVGVoiceControls.compatible()&&(o.SVGVoiceControls.setOn(!0),this.voice.start(function(t){var n=t.confidence,a=t.transcript;console.log("Voice received:"),console.log(n,a);var o=e.voice.parseAction(a);if(o)switch(console.log("Parsed as",o),o.name){case"unknown":return void e.onUnknownVoiceCommand();case"search":return void e.onSearchVoiceQuery(o.query);case"select":return void e.onSearchResultSelected(e.toDigit(o.item));case"route":return void e.onRouteCommand({origin:o.origin,target:o.target});case"access-routes":return void e.onRouteCommand(null);case"zoom":return void e.navigationHandler("acercar"===o.direction?"zoom-in":"zoom-out");default:return void e.navigationHandler(o.direction)}}))},e.prototype.stopVoice=function(){o.SVGVoiceControls.compatible()&&void 0!==this.voice&&(o.SVGVoiceControls.setOn(!1),this.voice.stop())},e.prototype.navigationHandler=function(e){var t=20-a.SVGMap.instance.zoomlevel+15,n=0,o=0;switch(e){case"up":o=-t;break;case"down":o=t;break;case"left":n=-t;break;case"right":n=t;break;case"zoom-in":return a.SVGMap.instance.zoomlevel=20==a.SVGMap.instance.zoomlevel?a.SVGMap.instance.zoomlevel:a.SVGMap.instance.zoomlevel+1,void a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel);case"zoom-out":return a.SVGMap.instance.zoomlevel=1==a.SVGMap.instance.zoomlevel?a.SVGMap.instance.zoomlevel:a.SVGMap.instance.zoomlevel-1,void a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel)}a.SVGMap.instance.move(n,o)},e.prototype.toDigit=function(e){var t=["uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez"];console.log(t.length,e);for(var n=0;n<t.length;n++)if(t[n]==e)return n+1;return-1},e}();t.SVGControls=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),o=function(){function e(){this.time_per_word=500,e.compatible()&&(this.list=new webkitSpeechGrammarList,this.list.addFromString(""),this.voice=new webkitSpeechRecognition,this.voice.lang="es-ES",this.voice.interimResults=!1,this.voice.maxAlternatives=1,this.voice.grammars=this.list,this.voice.continuous=!0),this.container=document.getElementById("speech")}return e.compatible=function(){return"undefined"!=typeof SpeechRecognition||"undefined"!=typeof webkitSpeechRecognition},e.isOn=function(){return this.on},e.setOn=function(e){this.on=e},e.prototype.say=function(t){var n=this,a=e.isOn();e.setOn(!1),this.stop(),this.container.innerHTML="",this.container.innerHTML=t,setTimeout(function(){e.setOn(a),n.start(n.onTranscript)},this.time_per_word*t.split(" ").length)},e.prototype.start=function(t){var n=this;if(console.log(e.isOn()),e.isOn()){this.onTranscript=t,this.voice.onresult=function(e){n.voice.stop();var a=e.results.length-1,o=e.results[a][0].transcript,i=e.results[a][0].confidence;i>=.75?t({confidence:i,transcript:o}):(console.log("Ignoring because of low confidence:"),console.log("("+i+") "+o))},this.voice.onend=function(){var n=this;console.log("Voice end and on="+e.isOn()),e.isOn()&&setTimeout(function(){n.start(t)},1e3)};try{this.voice.start()}catch(e){}console.log("Voice started...")}},e.prototype.stop=function(){this.voice.stop()},e.prototype.parseAction=function(e){var t=a.voiceParse(e);if(console.log(t),"move"==t.name)switch(t.direction){case"la derecha":t.direction="right";break;case"la izquierda":t.direction="left";break;case"arriba":t.direction="up";break;case"abajo":t.direction="down";break;default:t.direction=null}else if("zoom"===t.action)switch(t.direction){case"alejar":t.direction="zoom-out";break;case"acercar":t.direction="zoom-in";break;default:t.direction=null}return t},e.on=!1,e}();t.SVGVoiceControls=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){this.orientationAccum=0}return e.prototype.isGeolocationAvailable=function(){return"geolocation"in navigator},e.prototype.watch=function(e){this.isGeolocationAvailable()&&navigator.geolocation.watchPosition(function(t){e(t.coords.latitude,t.coords.longitude)},function(e){console.log("[LOCATION WATCH] error",e)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},e.prototype.getCurrentPosition=function(e){navigator.geolocation.getCurrentPosition(function(t){e(t.coords.latitude,t.coords.longitude)},function(e){console.log("[LOCATION GET] error",e)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})},e.prototype.watchOrientation=function(e){var t=this;window.addEventListener("deviceorientation",function(n){50==t.orientationAccum?(t.orientationAccum=0,e(n.alpha,n.beta,n.gamma)):t.orientationAccum++})},e}();t.SVGLocation=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(1);$(document).ready(function(){window.gsvg=a.SVGMap.instance.svg,o.SVGControls.instance.pageLoad(),a.SVGMap.instance.moveTo(717444.93870502,-4251399.25399798);var e=!1;$("body").not("input").not("textarea").keydown(function(t){if(e=e||18==t.which){var n="";switch(t.which){case 189:case 171:n="zoom-out";break;case 187:case 173:n="zoom-in";break;case 38:n="up";break;case 40:n="down";break;case 37:n="left";break;case 39:n="right"}o.SVGControls.instance.navigationHandler(n)}}),$("body").not("input").not("textarea").keyup(function(t){18==t.which&&(e=!1)});var t,n,i=!1,r=!1,s="ontouchstart"in window?"touchmove":"mousemove",c="ontouchstart"in window?"touchend":"mouseup",l="ontouchstart"in window?"touchstart":"mousedown",u=$(a.SVGMap.instance.container).get(0).getScreenCTM();console.log(u),$(a.SVGMap.instance.container).on(l,function(e){e.preventDefault(),i=!("ontouchstart"in window)||1==e.touches.length,t="ontouchstart"in window?e.targetTouches[0].pageX:e.pageX,n="ontouchstart"in window?e.targetTouches[0].pageY:e.pageY}),$(a.SVGMap.instance.container).on(c,function(e){r&&a.SVGMap.instance.groupMarkers(a.SVGMap.instance.zoomlevel),i=!1}),$(a.SVGMap.instance.container).on(s,function(e){if(i){var o="ontouchstart"in window?e.targetTouches[0].pageX:e.pageX,s="ontouchstart"in window?e.targetTouches[0].pageY:e.pageY,c=(o-t)/-35,l=(s-n)/-35;a.SVGMap.instance.move(c,l,!1),r=!0}});var d,p=!1;$(a.SVGMap.instance.container).on("mousewheel DOMMouseScroll",function(e){if(e.preventDefault(),!p){var t="number"==typeof e.originalEvent.detail&&0!==e.originalEvent.detail?e.originalEvent.detail:e.originalEvent.wheelDelta;console.log("wheel",t),t>0?a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel+1,!0):a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel-1,!0),p=!0,setTimeout(function(){return p=!1},400)}});var v=!1;$(a.SVGMap.instance.container).on("touchstart",function(e){2==e.touches.length&&(v=!0,d=Math.abs(e.touches[0].pageX-e.touches[1].pageX))}),$(a.SVGMap.instance.container).not("a").on("touchmove",function(e){(e.preventDefault(),v&&!p&&2==e.touches.length)&&(Math.abs(e.touches[0].pageX-e.touches[1].pageX)>d?(a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel+1,!0),p=!0):(a.SVGMap.instance.resizeToLevel(a.SVGMap.instance.zoomlevel-1,!0),p=!0),setTimeout(function(){return p=!1},400))})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=[{name:"antiloop",pattern:/(No te he entendido)|(El mapa está ahora escuchando)/i,extract:[]},{name:"move",pattern:/(mover) (mapa |mapas |plano )?(a |hacia |para )?(la derecha|la izquierda|arriba|abajo)/i,extract:[{name:"direction",position:4}]},{name:"zoom",pattern:/(alejar|acercar)( mapa)?/i,extract:[{name:"direction",position:1}]},{name:"search",pattern:/(buscar) ([\w | \d]+)+/i,extract:[{name:"query",position:2}]},{name:"select",pattern:/(seleccionar |elegir |escoger |ver )(número |resultado )*(\w+)+/i,extract:[{name:"item",position:3}]},{name:"access-routes",pattern:/i((acceder a)|(acceso a)|(ir a)) (((cálculo de)|(calcular)|(calculo de))+ )*(ruta)/i,extract:[]},{name:"route",pattern:/((ir )|(calcular ruta ))*desde ((\w|\d| )+) hasta ((\w|\d| )+)/i,extract:[{name:"origin",position:4},{name:"target",position:6}]}];t.voiceParse=function(e){for(var t=0,n=a;t<n.length;t++){var o=n[t],i=e.match(o.pattern);if(null!=i){for(var r={name:o.name},s=0,c=o.extract;s<c.length;s++){var l=c[s];r[l.name]=i[l.position]}return r}}return{name:"unknown"}}},,function(e,t,n){n(4),e.exports=n(8)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(9),i=n(2);$(document).ready(function(){loadSettings(),$("form[action='']").on("submit",function(e){e.preventDefault()}),$("#pad .btn").click(function(e){e.preventDefault(),a.SVGControls.instance.navigationHandler($(this).attr("data-map-nav"))}),$("#searchform").on("submit",function(e){e.preventDefault();var t=$("#queryTxt").val();o.search(t)}),i.SVGVoiceControls.compatible()&&($("#voicePanel").css("display","block"),a.SVGControls.instance.onSearchVoiceQuery=function(e){console.log(e),o.search(e,!0)},a.SVGControls.instance.onUnknownVoiceCommand=function(){a.SVGControls.instance.voiceControl.say("No te he entendido.")},a.SVGControls.instance.onRouteCommand=function(e){null!=e||(window.location.href="/route")},$("#dictateBtn").on("click",function(e){e.preventDefault(),"true"==$(this).attr("data-dictating")?(a.SVGControls.instance.stopVoice(),$(this).attr("data-dictating","false"),$(this).removeClass("active"),$("#dictateStatus").html("Haz click para comenzar a escuchar"),a.SVGControls.instance.voiceControl.say("El mapa ha dejado de escuchar.")):(a.SVGControls.instance.startVoice(),$(this).attr("data-dictating","true"),$(this).addClass("active"),$("#dictateStatus").html("Escuchando..."),a.SVGControls.instance.voiceControl.say("El mapa está ahora escuchando.")),$(this).blur()}))})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(0);function i(e,t,n,a){void 0!=t&&void 0!=n?(o.SVGMap.instance.zoomAndMove(t,n,7),r(e)):void 0!==a&&a.say("No se ha podido seleccionar ese resultado.")}function r(e){$.get("/map/data/b/"+e,function(e){for(var t in $("#dataPanel").css("display","block"),$("#resultsPanel").css("display","none"),$("#dataPanel table").empty(),e)if(e[t].userinterest){var n=document.createElement("tr"),a=document.createElement("th"),o=document.createElement("td");$(a).html(e[t].display),$(o).html(e[t].value),$(n).append(a),$(n).append(o),$("#dataPanel table").prepend(n)}})}t.search=function(e,t){void 0===t&&(t=!1),$.getJSON("/map/data/s/name/"+e,function(n){var o=n.results;console.log(o),$("#dataPanel").css("display","none"),$("#resultsPanel").css("display","block"),$("#resultsPanel table").empty();for(var r=1,s="Estos son los resultados para la búsqueda "+e,c=0,l=o;c<l.length;c++){var u=l[c],d=document.createElement("tr"),p=document.createElement("th"),v=document.createElement("td"),h=document.createElement("button");$(h).addClass("btn btn-success result-view").html("Ir").attr("aria-label","Ver en el mapa "+u.name+"."),$(h).attr("data-centerx",u.centerx).attr("data-centery",u.centery),$(h).attr("data-result-id",r),$(h).attr("data-feature-id",u.id),$(v).append(h),$(p).html(u.name),$(d).append(p),$(d).append(v),$("#resultsPanel table").append(d),t&&(s+="\n Resultado número "+r+": "+u.name),r++}t&&(s+="\n Selecciona un resultado para verlo en el mapa.",a.SVGControls.instance.onSearchResultSelected=function(e){var t=$(".result-view[data-result-id='"+e+"']").attr("data-centerx"),n=$(".result-view[data-result-id='"+e+"']").attr("data-centery");i($(".result-view[data-result-id='"+e+"']").attr("data-feature-id"),t,n,a.SVGControls.instance.voiceControl)},a.SVGControls.instance.voiceControl.say(s)),$("#data-status").html("Búsqueda de '"+e+"'"),$("#resultsPanel").trigger("focus"),$("button.result-view").on("click",function(e){e.preventDefault();var t=$(this).attr("data-centerx"),n=$(this).attr("data-centery");i($(this).attr("data-feature-id"),t,n)})})},t.focusBuilding=i,t.showBuildingInfo=r}]);